// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// ENUMS - Matching Laravel enum values
// ============================================

// VerificationStatus now stored as String to match Laravel
// Valid values: PENDING, VERIFIED, REJECTED

// JobType now stored as String to match Laravel
// Valid values: LOKER, MAGANG

// ProductCategory now stored as String to match Laravel
// Valid values: JASA, PRODUK

// ============================================
// BASE MODELS
// ============================================

model Role {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users User[]

  @@map("roles")
}

model Province {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  cities City[]
  users  User[]
  jobs   Job[]

  @@map("provinces")
}

model City {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  province   Province @relation(fields: [provinceId], references: [id])
  provinceId String   @map("province_id") @db.Uuid

  users User[]
  jobs  Job[]

  @@map("cities")
}

model Faculty {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  users  User[]
  majors Major[]

  @@map("faculties")
}

model Major {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  faculty   Faculty @relation(fields: [facultyId], references: [id])
  facultyId String  @map("faculty_id") @db.Uuid

  users User[]

  @@map("majors")
}

model JobField {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  jobs Job[]

  @@map("job_fields")
}

model CollaborationField {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  collaborations Collaboration[]

  @@map("collaboration_fields")
}

// ============================================
// USER MODEL
// ============================================

model User {
  id                  String   @id @default(uuid()) @db.Uuid
  nim                 String   @unique
  name                String
  email               String   @unique
  password            String
  placeDateOfBirth    String?  @map("place_date_of_birth")
  phoneNumber         String   @unique @map("phone_number")
  enrollmentYear      Int      @map("enrollment_year")
  graduationYear      Int      @map("graduation_year")
  instance            String?
  position            String?
  verificationFileUrl String   @map("verification_file_url")
  profilePictureUrl   String?  @map("profile_picture_url")
  refreshToken        String?  @map("refresh_token")
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  verificationStatus String @default("PENDING") @map("verification_status")

  role       Role     @relation(fields: [roleId], references: [id])
  roleId     String   @map("role_id") @db.Uuid
  province   Province @relation(fields: [provinceId], references: [id])
  provinceId String   @map("province_id") @db.Uuid
  city       City     @relation(fields: [cityId], references: [id])
  cityId     String   @map("city_id") @db.Uuid
  faculty    Faculty  @relation(fields: [facultyId], references: [id])
  facultyId  String   @map("faculty_id") @db.Uuid
  major      Major    @relation(fields: [majorId], references: [id])
  majorId    String   @map("major_id") @db.Uuid

  forums         Forum[]
  jobs           Job[]
  collaborations Collaboration[]
  products       Product[]
  forumComments  ForumComment[]
  forumLikes     ForumLike[]
  news           News[]

  @@index([verificationStatus])
  @@index([roleId])
  @@index([provinceId])
  @@index([cityId])
  @@index([facultyId])
  @@index([majorId])
  @@index([createdAt])
  @@map("users")
}

// ============================================
// FEATURE MODELS
// ============================================

model Job {
  id               String   @id @default(uuid()) @db.Uuid
  title            String
  content          String   @db.Text
  company          String
  jobType          String   @map("job_type")
  openFrom         DateTime @map("open_from")
  openUntil        DateTime @map("open_until")
  registrationLink String?  @map("registration_link")
  imageUrl         String?  @map("image_url")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  postedBy   User     @relation(fields: [postedById], references: [id])
  postedById String   @map("posted_by_id") @db.Uuid
  jobField   JobField @relation(fields: [jobFieldId], references: [id])
  jobFieldId String   @map("job_field_id") @db.Uuid
  province   Province @relation(fields: [provinceId], references: [id])
  provinceId String   @map("province_id") @db.Uuid
  city       City     @relation(fields: [cityId], references: [id])
  cityId     String   @map("city_id") @db.Uuid

  @@index([jobType])
  @@index([provinceId])
  @@index([cityId])
  @@index([jobFieldId])
  @@index([createdAt])
  @@map("jobs")
}

model Collaboration {
  id        String   @id @default(uuid()) @db.Uuid
  title     String
  content   String   @db.Text
  imageUrl  String?  @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  postedBy             User                @relation(fields: [postedById], references: [id])
  postedById           String              @map("posted_by_id") @db.Uuid
  collaborationField   CollaborationField? @relation(fields: [collaborationFieldId], references: [id])
  collaborationFieldId String?             @map("collaboration_field_id") @db.Uuid

  @@index([collaborationFieldId])
  @@index([createdAt])
  @@map("collaborations")
}

model Product {
  id          String   @id @default(uuid()) @db.Uuid
  name        String
  description String   @db.Text
  price       Decimal  @db.Decimal(10, 2)
  category    String
  imageUrl    String?  @map("image_url")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  postedBy   User   @relation(fields: [postedById], references: [id], onDelete: Cascade)
  postedById String @map("posted_by_id") @db.Uuid

  @@index([category])
  @@index([price])
  @@index([postedById])
  @@index([createdAt])
  @@map("products")
}

model Forum {
  id        String   @id @default(uuid()) @db.Uuid
  title     String
  content   String   @db.Text
  imageUrl  String?  @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  postedBy   User   @relation(fields: [postedById], references: [id], onDelete: Cascade)
  postedById String @map("posted_by_id") @db.Uuid

  comments   ForumComment[]
  forumLikes ForumLike[]

  @@index([postedById])
  @@index([createdAt])
  @@map("forums")
}

model ForumComment {
  id        String   @id @default(uuid()) @db.Uuid
  content   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  postedBy   User   @relation(fields: [postedById], references: [id], onDelete: Cascade)
  postedById String @map("posted_by_id") @db.Uuid

  forum   Forum  @relation(fields: [forumId], references: [id], onDelete: Cascade)
  forumId String @map("forum_id") @db.Uuid

  @@index([forumId])
  @@index([createdAt])
  @@map("forum_comments")
}

model ForumLike {
  id        String   @id @default(uuid()) @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  likedBy   User   @relation(fields: [likedById], references: [id], onDelete: Cascade)
  likedById String @map("liked_by_id") @db.Uuid

  forum   Forum  @relation(fields: [forumId], references: [id], onDelete: Cascade)
  forumId String @map("forum_id") @db.Uuid

  @@unique([forumId, likedById])
  @@index([forumId])
  @@map("forum_likes")
}

model News {
  id        String   @id @default(uuid()) @db.Uuid
  title     String
  content   String   @db.Text
  date      DateTime @default(now())
  imageUrl  String?  @map("image_url")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  postedBy   User   @relation(fields: [postedById], references: [id])
  postedById String @map("posted_by_id") @db.Uuid

  @@index([createdAt])
  @@index([date])
  @@map("news")
}
